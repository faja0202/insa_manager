{% extends "base.html" %}
{% block title %}직원 프로필{% endblock %}
{% block content %}
<div class="container">
  <div class="employee-detail">
    <!-- 플래시 메시지 영역 -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ul id="messages" aria-live="polite">
          {% for category, message in messages %}
            <li class="{{ category }}">{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <!-- 상단 탭: 기본/상세 + PDF 아이콘 -->
    <div class="tabs" role="tablist" aria-label="프로필 섹션 전환">
      <!-- 실제 탭은 role="tab" 을 가짐 -->
      <div class="tab active" data-target="basic-info" role="tab" aria-selected="true" aria-controls="basic-info">기본 정보</div>
      <div class="tab" data-target="extended-info" role="tab" aria-selected="false" aria-controls="extended-info">상세 정보</div>

      <!-- PDF 아이콘은 탭이 아님: role="button" -->
      <div class="tab"
          title="이력서 보기"
          onclick="checkResume('{{ employee.name }}')"
          style="margin-left:auto; display:flex; align-items:center; gap:.35rem;"
          role="button" tabindex="0"
          onkeydown="if(event.key==='Enter' || event.key===' ') this.click();">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
             viewBox="0 0 24 24" fill="none" stroke="currentColor"
             stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
             aria-hidden="true">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <path d="M14 2v6h6"/>
          <text x="7" y="16" font-size="7" font-family="monospace">PDF</text>
        </svg>
        <span>이력서</span>
      </div>
    </div>

        <!-- 팝업 모달 -->
        <div id="resume-modal" class="modal">
          <div class="modal-content">
            <p>업로드 된 이력서가 없습니다!</p>
            <button onclick="closeModal()" class="btn">확인</button>
          </div>
        </div>

    <div class="form-actions">
      <!-- '수정' 버튼: 모든 입력 enable/disable 토글 -->
      <button type="button" id="edit-btn" class="btn">수정</button>
      <!-- '저장' 버튼: 폼 제출 -->
      <button type="submit" id="save-btn" form="detail-form" class="btn" style="display: none;">저장</button>
    </div>

    <form id="detail-form" method="POST"
          action="{{ url_for('employee_detail', name=employee.name) }}"
          autocomplete="off">

      <!-- 기본 정보 섹션 -->
      <section id="basic-info" class="profile-section active" role="tabpanel" aria-labelledby="basic-tab">
        <h2 class="section-title">기본 정보</h2>
        <div class="profile-header">
          <div class="profile-photo">
            <img src="{{ url_for('photo_view', name=employee.name if employee else 'default') }}"
                alt="프로필 사진"
                onerror="this.src='{{ url_for('photo_view', name='default') }}'">
          </div>

          <div class="profile-summary">
            <div class="profile-item">
              <label>이름</label>
              <input type="text" name="name" value="{{ employee.name if employee else '' }}" readonly>
            </div>
            <div class="profile-item">
              <label>팀 소속</label>
              <input type="text" name="team_name" value="{{ employee.team_name if employee else '' }}">
            </div>
            <div class="profile-item">
              <label>직책</label>
              <input type="text" name="position" value="{{ employee.position if employee else '' }}">
            </div>
            <div class="profile-item">
              <label>내선번호</label>
              <input type="text" name="extension_number" inputmode="numeric" pattern="[0-9\-]*" value="{{ employee.extension_number if employee else '' }}">
            </div>
          </div>
        </div>

        <div class="profile-grid">
          <div class="profile-item">
            <label>주민등록번호</label>
            <input type="text" name="ssn" value="{{ employee.ssn if employee and employee.ssn else '' }}">
          </div>
          <div class="profile-item">
            <label>생년월일</label>
            <input type="date" name="birthdate" value="{{ employee.birthdate if employee and employee.birthdate else '' }}">
          </div>
          <div class="profile-item">
            <label>연락처</label>
            <input type="text" name="phone_number" inputmode="tel" pattern="[0-9\-+ ]*" value="{{ employee.phone_number if employee else '' }}">
          </div>
          <div class="profile-item">
            <label>비상연락처</label>
            <input type="text" name="emergency_contact" inputmode="tel" pattern="[0-9\-+ ]*" value="{{ employee.emergency_contact if employee and employee.emergency_contact else '' }}">
          </div>
          <div class="profile-item">
            <label>MBTI 유형</label>
            <input type="text" name="mbti" value="{{ employee.mbti if employee else '' }}">
          </div>
          <div class="profile-item">
            <label>STRONG 유형</label>
            <input type="text" name="strong_type" value="{{ employee.strong_type if employee and employee.strong_type else '' }}">
          </div>
          <div class="profile-item">
            <label>FIRO-B (I/C/A)</label>
            <div class="firo-group">
              <input type="text" name="firo_i" value="{{ employee.firo_i if employee and employee.firo_i else '' }}" placeholder="I">
              <input type="text" name="firo_c" value="{{ employee.firo_c if employee and employee.firo_c else '' }}" placeholder="C">
              <input type="text" name="firo_a" value="{{ employee.firo_a if employee and employee.firo_a else '' }}" placeholder="A">
            </div>
          </div>

          <div class="profile-item">
            <label>내부 교육</label>
            <textarea name="internal_training" rows="2" class="auto-list auto-grow">{{ employee.internal_training if employee and employee.internal_training else '' }}</textarea>
          </div>

          <div class="profile-item">
            <label>이메일</label>
            <input type="email" name="email" value="{{ employee.email if employee and employee.email else '' }}" autocapitalize="none" autocorrect="off" spellcheck="false">
          </div>
          <div class="profile-item">
            <label>입사일</label>
            <input type="date" name="hire_date" value="{{ employee.hire_date if employee else '' }}">
          </div>
          <div class="profile-item">
            <label>퇴사일</label>
            <input type="date" name="exit_date" value="{{ employee.exit_date if employee and employee.exit_date else '' }}">
          </div>
          <div class="profile-item">
            <label>퇴사 사유</label>
            <input type="text" name="exit_reason" value="{{ employee.exit_reason if employee and employee.exit_reason else '' }}">
          </div>
        </div>
      </section>

      <!-- 상세 정보 섹션 (hidden 속성 제거; JS가 hidden을 제어) -->
      <section id="extended-info" class="profile-section" role="tabpanel" aria-labelledby="extended-tab">
        <h2 class="section-title">상세 정보</h2>
        <div class="profile-header">
          <div class="profile-photo">
            <img src="{{ url_for('photo_view', name=employee.name if employee else 'default') }}"
                alt="프로필 사진"
                onerror="this.src='{{ url_for('photo_view', name='default') }}'">
          </div>
          <div class="profile-summary">
            <div class="profile-item">
              <label>주소</label>
              <input type="text" name="address" value="{{ employee.address if employee and employee.address else '' }}">
            </div>
            <div class="profile-item">
              <label>학력 (전공)</label>
              <input type="text" name="major" value="{{ employee.major if employee and employee.major else '' }}">
            </div>
            <div class="profile-item">
              <label>학위</label>
              <input type="text" name="degree" value="{{ employee.degree if employee and employee.degree else '' }}">
            </div>
            <div class="profile-item">
              <label>논문</label>
              <input type="text" name="thesis" value="{{ employee.thesis if employee and employee.thesis else '' }}">
            </div>
          </div>
        </div>

        <div class="profile-grid">
          <div class="profile-item">
            <label>이전 직장 이력</label>
            <textarea name="work_history" rows="3" class="auto-list auto-grow">{{ employee.work_history if employee and employee.work_history else '' }}</textarea>
          </div>
          <div class="profile-item">
            <label>자격증·면허</label>
            <textarea name="certification" rows="2" class="auto-list auto-grow">{{ employee.certification if employee and employee.certification else '' }}</textarea>
          </div>

          <div class="profile-item">
            <label>연봉</label>
            <input type="number" name="salary" inputmode="numeric" step="1" min="0"
                   value="{{ employee.salary if employee and employee.salary else '' }}">
          </div>

          <div class="profile-item">
            <label>징계·포상 이력</label>
            <textarea name="discipline_awards" rows="2" class="auto-list auto-grow">{{ employee.discipline_awards if employee and employee.discipline_awards else '' }}</textarea>
          </div>
          <div class="profile-item">
            <label>최근 주요 프로젝트</label>
            <textarea name="recent_projects" rows="2" class="auto-list auto-grow">{{ employee.recent_projects if employee and employee.recent_projects else '' }}</textarea>
          </div>

          <div class="profile-item">
            <label>대표님 면담 기록</label>
            <textarea name="ceo_meeting_notes" rows="3">{{ employee.ceo_meeting_notes if employee and employee.ceo_meeting_notes else '' }}</textarea>
          </div>
          <div class="profile-item profile-item-wide">
            <label>특이사항 메모</label>
            <textarea name="notes" rows="3">{{ employee.notes if employee and employee.notes else '' }}</textarea>
          </div>
        </div>
      </section>
    </form>
  </div>

  <!-- 로딩 오버레이 -->
  <div class="loading-overlay" id="loading" aria-hidden="true">
    <div class="spinner" role="status" aria-label="로딩 중"></div>
  </div>
</div>

<!-- 페이지 하단에서 스크립트 로드 (이 페이지 전용) -->
<script src="{{ url_for('static', filename='scripts/employee_detail.js') }}" defer></script>
{% endblock %}
